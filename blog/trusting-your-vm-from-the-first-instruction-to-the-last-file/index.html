<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Trusting Your VM from the First Instruction to the Last File - Ultraviolet</title>
  <meta name="title" content="Trusting Your VM from the First Instruction to the Last File - Ultraviolet" />
  <meta name="description" content="Learn about secured bot, measured boot, TPM and Linux IMA in the context of COCOS AI." />

  <link rel="canonical" href="https://www.ultraviolet.rs/blog/trusting-your-vm-from-the-first-instruction-to-the-last-file/" />

  <meta property="og:type" content="article" />
  <meta property="og:site_name" content="Ultraviolet" />
  <meta property="og:url" content="https://www.ultraviolet.rs/blog/trusting-your-vm-from-the-first-instruction-to-the-last-file" />
  <meta property="og:title" content="Trusting Your VM from the First Instruction to the Last File" />
  <meta property="og:description" content="Learn about secured bot, measured boot, TPM and Linux IMA in the context of COCOS AI." />
  <meta property="og:image" content="https://www.ultraviolet.rs{https://www.ultraviolet.rs/img/header.avif}" />

  
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Trusting Your VM from the First Instruction to the Last File" />
  <meta name="twitter:description" content="Learn about secured bot, measured boot, TPM and Linux IMA in the context of COCOS AI." />
  <meta name="twitter:image" content="https://www.ultraviolet.rs{https://www.ultraviolet.rs/img/header.avif}" />


  
  <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "headline": "Trusting Your VM from the First Instruction to the Last File",
        "image": "https:\/\/www.ultraviolet.rs",
        "datePublished": "2026-02-09",
        "author": {
          "@type": "Person",
          "name": "Jovan Djukic"
        },
        "description": "Learn about secured bot, measured boot, TPM and Linux IMA in the context of COCOS AI."
      }
    </script>

  
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="shortcut icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-title" content="Ultraviolet" />
  <link rel="manifest" href="/site.webmanifest" />

  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Outfit&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lexend&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Sen&display=swap" />

  
  <link rel="stylesheet" type="text/css" href="/style.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet" />
  <link rel="stylesheet" type="text/css"
    href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />

  
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

  <style>
    .navbar-nav .nav-link {
      color: black !important;
    }

     
    .markdown-content img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin: 1.5rem auto;
      display: block;
    }

    .markdown-content h2,
    .markdown-content h3 {
      margin-top: 2rem;
      margin-bottom: 1rem;
      font-weight: 700;
      color: #212529;
    }

    .markdown-content p {
      margin-bottom: 1.25rem;
      line-height: 1.8;
      font-size: 1.1rem;
      color: #333;
    }

    .markdown-content pre {
      border-radius: 6px;
      padding: 1rem;
    }

    .markdown-content blockquote {
      border-left: 4px solid #ddd;
      padding-left: 1rem;
      color: #555;
      margin: 1.5rem 0;
      font-style: italic;
    }

    .markdown-content table {
      border-collapse: collapse;
      width: 100%;
      margin: 1.5rem 0;
    }

    .markdown-content th,
    .markdown-content td {
      border: 1px solid #ddd;
      padding: 0.6rem 0.8rem;
    }

    .markdown-content th {
      background: #f5f5f5;
      font-weight: 600;
    }

    .code-wrapper {
      position: relative;
      margin-bottom: 1.5rem;
    }

    .code-wrapper pre {
      margin-bottom: 0;
    }

    .copy-button {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      padding: 0.2rem 0.5rem;
      font-size: 0.85rem;
      background: rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      cursor: pointer;
      opacity: 0;
      transition: all 0.2s ease;
      z-index: 10;
    }

    .code-wrapper:hover .copy-button {
      opacity: 1;
    }

    .copy-button:hover {
      background: rgba(255, 255, 255, 0.2);
      color: #fff;
    }

    .copy-button.copied {
      background: #198754;
      border-color: #198754;
      color: #fff;
      opacity: 1;
    }

     
    .markdown-content pre[class*="language-mermaid"] {
      background: transparent;
      padding: 0;
      border: none;
    }

    .markdown-content code[class*="language-mermaid"] {
      display: none;
    }

    .mermaid {
      display: flex;
      justify-content: center;
      margin: 1.5rem 0;
      background: #f8f9fa;
      border-radius: 8px;
      padding: 1.5rem;
    }
  </style>
</head>

<body>
  
  <nav class="navbar navbar-expand-lg fixed-top" style="background-color: #ffffff">
    <div class="container">
      <a class="navbar-brand" href="/">
        <img src="/img/logos/UltraViolet_logo-horizontal.svg" alt="Magistrala" height="30" width="250" />
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="productsDropdown" role="button" data-bs-toggle="dropdown"
              aria-expanded="false" style="color: black">
              PRODUCTS
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="productsDropdown">
              <li><a class="dropdown-item" href="https://prism.ultraviolet.rs"
                  title="Prism AI Multi-Party Confidential Computation Orchestration Platform" target="_blank">PRISM
                  AI</a></li>
              <li><a class="dropdown-item" href="/cocos"
                  title="Cocos AI Open Source Confidential Computing Platform">COCOS AI</a></li>
              <li><a class="dropdown-item" href="/cube"
                  title="Cube AI Privacy-Preserving LLM Deployment Framework with Confidential Computing">CUBE AI</a>
              </li>
              <li>
                <a class="dropdown-item" href="/products">All Products</a>
              </li>
            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown"
              aria-expanded="false" style="color: black">
              DOCUMENTATION
            </a>
            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
              <li>
                <a class="dropdown-item" href="https://docs.prism.ultraviolet.rs/" target="_blank">PRISM AI</a>
              </li>
              <li>
                <a class="dropdown-item" href="https://docs.cocos.ultraviolet.rs/" target="_blank">COCOS AI</a>
              </li>
              <li>
                <a class="dropdown-item" href="https://docs.cube.ultraviolet.rs/" target="_blank">CUBE AI</a>
              </li>
            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="projectsDropdown" role="button" data-bs-toggle="dropdown"
              aria-expanded="false" style="color: black">
              PROJECTS
            </a>
            <ul class="dropdown-menu" aria-labelledby="projectsDropdown">
              <li>
                <a class="dropdown-item" href="/projects/confidential6g">CONFIDENTIAL6G</a>
              </li>
              <li>
                <a class="dropdown-item" href="/projects/elastic">ELASTIC</a>
              </li>
              <li>
                <a class="dropdown-item" href="/projects/titan">TITAN</a>
              </li>
              <li>
                <a class="dropdown-item" href="/projects">All Projects</a>
              </li>
            </ul>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/company" style="color: black">COMPANY</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/careers" style="color: black">CAREERS</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/contact" style="color: black">CONTACT</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/blog" style="color: black">BLOG</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/ultravioletrs" target="_blank" style="color: black"><i
                class="fab fa-github"></i></a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <article class="container py-5 mt-5">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        
        <div class="mb-4">
          <a href="/blog" class="text-decoration-none text-muted"><i class="fas fa-arrow-left me-2"></i>Back to Blog</a>
        </div>

        <div class="mb-3">
          <span class="badge bg-primary fs-6"></span>
          
        </div>

        <h1 class="display-4 fw-bold mb-4">Trusting Your VM from the First Instruction to the Last File</h1>

        <div class="d-flex align-items-center mb-4 pb-4 border-bottom">
          <img src="https://avatars.githubusercontent.com/u/44265300?v=4" alt="Jovan Djukic" class="rounded-circle me-3" width="60" height="60"
            loading="lazy" onerror="this.onerror=null; this.src = '/assets/team/default-avatar.jpg'" />
          <div>
            <div class="fw-bold fs-5">Jovan Djukic</div>
            <div class="text-muted">
              February 09, 2026 ¬∑ 12 min read
            </div>
          </div>
        </div>

        

        <div class="markdown-content"><p><img src="/img/trusting-your-vm-from-the-first-instruction-to-the-last-file/overview.png" alt=""></p>
<h3 id="introduction">Introduction</h3>
<p>With the rise of <strong>Trusted Execution Environments (TEEs)</strong>, cloud users
can now provision virtual machines with the strong guarantee that all
<em>data in use</em> remains encrypted. This advancement protects sensitive
workloads against exposure, even if the underlying infrastructure is
compromised.</p>
<p>However, encryption alone does not solve the entire trust problem. Since
the majority of the software stack‚Ää-‚Ääfrom firmware to operating system
components‚Ää-‚Ääis provided and managed by the <strong>Cloud Service Provider
(CSP)</strong>, users still need a reliable way to ensure that no untrusted or
malicious software is running inside their virtual machine.</p>
<p>In this article, I describe how <strong>COCOS AI [1]</strong> addresses this
challenge. The solution combines three complementary
technologies‚Ää-‚Ää<strong>Secure Boot, Measured Boot, and Linux Integrity
Measurement Architecture (IMA)</strong>‚Ää-‚Ääto build a continuous chain of
trust from the very first instruction executed during boot to the last
file loaded into memory.</p>
<h4 id="secure-boot-verifying-the-kernel-atstartup">Secure Boot: Verifying the Kernel at¬†Startup</h4>
<p><strong>Secure Boot [2]</strong> ensures that the firmware will load only <strong>signed
kernels</strong>. The kernel is signed with a private key, while the firmware
holds the corresponding public key. During boot, the firmware verifies
the kernel's signature before execution. If the kernel has been tampered
with or replaced, the signature check fails, and the boot process is
halted.</p>
<p>This mechanism guarantees that only kernels explicitly approved by the
system owner can run, preventing unauthorized modifications at the
earliest stage of the boot process.</p>
<h4 id="measured-boot-creating-a-verifiable-record">Measured Boot: Creating a Verifiable Record</h4>
<p>While Secure Boot enforces integrity, <strong>Measured Boot [3]</strong> records
integrity. At each stage of the boot process (firmware, bootloader,
kernel, etc.), components are <strong>measured</strong> (hashed using a cryptographic
hash function such as SHA-256). These measurements are extended into
special registers inside the <strong>Trusted Platform Module (TPM)</strong>, called
<strong>Platform Configuration Registers (PCRs)</strong>.</p>
<p>Each PCR is updated using the formula:</p>
<pre><code>PCR[i] = Hash(PCR[i] || ComponentHash)
</code></pre>
<p>This chaining mechanism means that even a small change in one component
produces a completely different final PCR value. As a result, users (or
remote attestation services) can later verify the expected state of the
system by comparing PCR values against a known baseline.</p>
<p>Measured Boot therefore provides <strong>tamper-evidence</strong>: it doesn't stop
malicious code from executing, but it guarantees that any modification
will be detectable.</p>
<h4 id="linux-ima-extending-trust-beyondboot">Linux IMA: Extending Trust Beyond¬†Boot</h4>
<p>Measured Boot covers integrity only up until the kernel is loaded. But
what about the rest of the software stack‚Ää-‚Äädrivers, shared libraries,
or application binaries‚Ää-‚Ääthat are brought into memory after boot?</p>
<p>This is where the <strong>Linux Integrity Measurement Architecture
(IMA)[4]</strong> comes in. IMA continuously measures files as they are
loaded into RAM, including both executables and data files. The
resulting measurements are logged in a text file (the IMA measurement
list) that can be used to verify system integrity after boot.</p>
<p>In other words, IMA closes the gap by ensuring that no unauthorized or
malicious code sneaks in after the kernel has taken over. Together with
Secure Boot and Measured Boot, it forms a <strong>complete trust chain</strong>:</p>
<ul>
<li>Secure Boot verifies what runs.</li>
<li>Measured Boot records what ran.</li>
<li>IMA monitors what continues to run.</li>
</ul>
<p>By combining Secure Boot, Measured Boot, and Linux IMA, <strong>COCOS AI</strong>
provides a comprehensive way to ensure that virtual machines are both
encrypted and verifiably trustworthy. This layered approach establishes
confidence not only in the confidentiality of your data, but also in the
integrity of the entire software stack‚Ää-‚Ääfrom the very first
instruction of boot to the last file loaded during runtime.</p>
<pre><code>[Secure Boot] ‚Üí [Measured Boot] ‚Üí [Linux IMA]
  &quot;Verifies&quot;       &quot;Records&quot;       &quot;Monitors&quot;
  Kernel sigs      Boot hashes    Files at runtime
</code></pre>
<p>In the rest of this article I will describe how to achieve this &quot;chain&quot;
of trust using open source components. The whole process will be done on
AMD SEV-SNP CPU.</p>
<h3 id="coconut-secure-vm-servicemodule">COCONUT Secure VM Service¬†Module</h3>
<p>The core part of this process is <strong>COCONUT SVSM [5]</strong>. This software
which aims to provide secure services and device emulations to guest
operating systems in confidential virtual machines (CVMs). It requires
AMD Secure Encrypted Virtualization with Secure Nested Paging (AMD
SEV-SNP), especially the VM Privilege Level (VMPL) feature.</p>
<h4 id="guest-firmware">Guest firmware</h4>
<p>Firstly, we need to build the firmware. A special <strong>OVMF</strong> build is
required to launch a guest on top of the <strong>COCONUT-SVSM</strong>. To build the
<strong>OVMF</strong> binary for the guest, first checkout this repository:</p>
<pre><code>$ git clone https://github.com/coconut-svsm/edk2.git
$ cd edk2/
$ git checkout svsm
$ git submodule init
$ git submodule update
</code></pre>
<p>Before building we need to make a few changes. This firmware starts an
emulated software <strong>TPM</strong> in <strong>VMPL0</strong>. However this emulated <strong>TPM</strong>
does not support <strong>SHA1 PCR</strong> bank. This register bank is needed to
verify the measurements produced by the <strong>Linux IMA</strong>. To enable this
bank we need to make a few modifications to the source code:</p>
<p>The following line needs to be added to
<em>SecurityPkg/Tcg/Tcg2Dxe/Tcg2Dxe.inf</em> file at the end of the <em>Pcd</em>
section:</p>
<pre><code>gEfiSecurityPkgTokenSpaceGuid.PcdTpm2HashMask
</code></pre>
<p>The following line needs to be added to <em>OvmfPkg/OvmfPkgX64.dsc</em> file at
the end of the <em>PcdsDynamicDefault</em> section:</p>
<pre><code>gEfiSecurityPkgTokenSpaceGuid.PcdTpm2HashMask|0x0000000C
</code></pre>
<p>These lines enable the <strong>SHA1</strong> bank. After the changes have been made,
we need to build the firmware:</p>
<pre><code>$ export PYTHON3_ENABLE=TRUE
$ export PYTHON_COMMAND=python3
$ make -j16 -C BaseTools/
$ source ./edksetup.sh --reconfig
$ build -a X64 -b DEBUG -t GCC5 -D DEBUG_ON_SERIAL_PORT -D DEBUG_VERBOSE -D TPM2_ENABLE -D SECURE_BOOT_ENABLE -p OvmfPkg/OvmfPkgX64.dsc
</code></pre>
<p>This will build the <strong>OVMF</strong> binary that will be packaged into the
<strong>IGVM</strong> [7] file to use with QEMU.</p>
<h4 id="generating-the-secure-bootkeys">Generating the secure boot¬†keys</h4>
<p>Secure Boot relies on a <strong>chain of trust</strong> anchored in cryptographic
keys stored in the firmware. These keys define <em>who</em> is trusted to
update firmware settings, <em>who</em> can sign software, and <em>which binaries</em>
are allowed or denied during boot.</p>
<p>The three most important keys are Platform Key (PK), Key Exchange Key
(KEK) and Signature Database Key (DB).</p>
<p>In the Secure Boot process, the <strong>Platform Key (PK)</strong> serves as the root
of trust for the system. It is typically owned by the original equipment
manufacturer (OEM) or the system administrator, and it establishes
ultimate authority over the Secure Boot configuration. Only the holder
of the PK can authorize changes to the Key Exchange Keys (KEKs), making
it the master key that defines who controls trust on the platform.</p>
<p>The <strong>Key Exchange Key (KEK)</strong> acts as a layer of delegation between the
platform owner and the operating system vendors or administrators.
Instead of the PK being used for everyday updates, KEKs are entrusted
with the responsibility of updating the Secure Boot signature databases.
In practice, this allows OS vendors, such as Microsoft or Linux
distributions, to provide updates that modify which binaries are trusted
or revoked. By signing these updates with a KEK, they can add to or
remove from the trusted lists without requiring the platform owner's PK
for every change.</p>
<p>The <strong>signature database (DB)</strong> is where the trusted software components
are defined. It contains certificates, cryptographic hashes, and
signatures of executables such as bootloaders, kernels, and drivers.
During the boot process, the firmware checks each component against the
DB, and only those that match entries in the database are allowed to
run. In this way, DB acts as a whitelist that ensures only verified
software is executed at boot time.</p>
<p>For this tutorial we will generate all these keys using <strong>openssl</strong>:</p>
<pre><code> # PK (self-signed)
 openssl req -x509 -newkey rsa:2048 -nodes \
   -subj &quot;/CN=Demo Platform Key/&quot; \
   -keyout PK.key -out PK.pem

 # KEK (CSR -&gt; signed by PK)
 openssl req -new -newkey rsa:2048 -nodes \
   -subj &quot;/CN=Demo KEK/&quot; \
   -keyout KEK.key -out KEK.csr
 openssl x509 -req -in KEK.csr -days 3650 \
   -CA PK.pem -CAkey PK.key -CAcreateserial -out KEK.pem

 # db (CSR -&gt; signed by KEK). This cert will sign EFI binaries.
 openssl req -new -newkey rsa:2048 -nodes \
   -subj &quot;/CN=Demo db/&quot; \
   -keyout DB.key -out DB.csr
 openssl x509 -req -in DB.csr -days 3650 \
   -CA KEK.pem -CAkey KEK.key -CAcreateserial -out DB.pem

 # Convert to DER (what firmware variables expect)
 openssl x509 -inform PEM -in PK.pem  -outform DER -out PK.cer
 openssl x509 -inform PEM -in KEK.pem -outform DER -out KEK.cer
 openssl x509 -inform PEM -in DB.pem  -outform DER -out DB.cer
</code></pre>
<p>Now we need to add these keys to firmware. For this we can use the
<strong>virt-firmware [8]</strong> tool. Run the following command:</p>
<pre><code>#!/bin/bash
UUDI=$uuidgen 

virt-fw-vars \
--input &lt;path to OVMF_VARS.fd&gt; \
--output &lt;path to new OVMF_VARS.secure.fd&gt; \
--set-pk   $UUID &lt;path to PK.cer&gt; \
--add-kek  $UUID &lt;path to KEK.cer&gt; \
--add-db   $UUID &lt;path to DB.cer&gt; \
--sb
</code></pre>
<p>This command will store public keys in <strong>OVMF_VARS.fd</strong>. You can check
what was written with the following command:</p>
<pre><code>virt-fw-vars -i OVMF_VARS.secure.fd --print | less
</code></pre>
<h4 id="combing-ovmf-varsfd-and-ovmf-codefd">Combing OVMF_VARS.fd and OVMF_CODE.fd</h4>
<p>Now that we made changes to <strong>OVMF_VARS.fd</strong> wee need to combine the
new <strong>OVMF_VARS.secure.fd</strong> and <strong>OVMF_CODE.fd</strong> into a single
<strong>OVMF.fd</strong> file. This file will then be used to generate an <strong>IGVM</strong>
file which will be used to start a VM with <strong>QEMU</strong>.</p>
<p>This is achieved with concatenating the vars and code files. First check
in which order are they concatenated. The EDK2 build already produced an
<strong>OVMF.fd</strong> file which we can use for this purpose:</p>
<pre><code>cmp &lt;(cat &lt;path to old OVMF_VARS.fd&gt; &lt;path to OVMF_CODE.fd&gt;) &lt;path to old OVMF.fd&gt; &amp;&amp; echo &quot;order is VARS+CODE&quot;
</code></pre>
<p>If the order is vars + code, the following command is going to
concatenate vars and code files:</p>
<pre><code>cat &lt;path to OVMF_VARS.fd with keys&gt; &lt;path t OVMF_CODE.fd&gt; &gt; &lt;path to new OVMF.secure.fd&gt;
</code></pre>
<h4 id="building-the-coconut-svsm-igvmfile">Building the COCONUT-SVSM IGVM¬†file</h4>
<p>Building the SVSM itself requires:</p>
<ul>
<li>a recent Rust compiler and build environment installed. Please
refer to <a href="https://rustup.rs/">https://rustup.rs/</a> on how to get this environment
installed.</li>
<li><code>x86_64-unknown-none</code> target
toolchain installed
(<code>rustup target add x86_64-unknown-none</code>{.markup--code
.markup--li-code})</li>
<li><code>binutils</code></li>
</ul>
<p>Then checkout the SVSM repository and build the SVSM binary:</p>
<pre><code>$ git clone https://github.com/coconut-svsm/svsm
$ cd svsm
$ git submodule update --init
$ FW_FILE=&lt;path to new OVMF.fd&gt; cargo xbuild --release configs/qemu-target.json
</code></pre>
<p>This will build a <strong>coconut-igvm.igvm</strong> file which will be placed in
<strong>svsm/bin</strong> directory. This file will be used as firmware when starting
the new VM. It will create a software <strong>TPM</strong> in <strong>VPML0</strong>.</p>
<h3 id="building-a-kernel-using-buildroot">Building a kernel using Buildroot</h3>
<p>If you want to build a basic Linux kernel and minimal root filesystem
with Buildroot, the process is surprisingly straightforward. After
installing the required packages (compilers, libraries, and utilities),
you clone the Buildroot repository. The next step is to configure the
necessary packages. For this you can use the <a href="https://github.com/ultravioletrs/cocos/tree/main/hal/linux">COCOS AI
configuration</a>. To build the kernel (<code>bzImage</code>) and an initial RAM file system
(<code>rootfs.cpio</code>) checkout the COCOS AI
repository and run the following commands:</p>
<pre><code>git clone git@github.com:ultravioletrs/cocos.git
git clone git@github.com:buildroot/buildroot.git
cd buildroot
git checkout 2025.05-rc1
make BR2_EXTERNAL=../cocos/hal/linux cocos_defconfig
# Execute 'make menuconfig' only if you want to make additional configuration changes to Buildroot.
make menuconfig
make
</code></pre>
<p>The kernel and the initial RAM file system can be found in the
<code>output/</code> directory. You can then boot
your new kernel with QEMU by pointing it to the kernel image and root
filesystem, appending the right console and root parameters.</p>
<p>There is one additional step. Since we are using the secure boot
feature, we need to sign this kernel:</p>
<pre><code> sbsign --key &lt;path to DB.key&gt; --cert &lt;path to DB.pem&gt; bzImage --output bzImage.signed
</code></pre>
<p>This kernel can be used with generated IGMV file to start the VM.</p>
<h3 id="building-qemu">Building QEMU</h3>
<p><strong>COCONUT-SVSM</strong> is packaged during the build into a file conforming to
the <strong>IGVM</strong> format. Current versions of <strong>QEMU</strong> do not support
launching guests using IGVM, but a branch is available that includes
this capability. This will need to be built in order to be able to
launch <strong>COCONUT-SVSM</strong>. Support for <strong>IGVM</strong> within <strong>QEMU</strong> depends on
the <strong>IGVM</strong> library. This will need to be built and installed prior to
building <strong>QEMU</strong>.</p>
<pre><code>$ git clone https://github.com/microsoft/igvm
$ cd igvm
$ make -f igvm_c/Makefile
$ sudo make -f igvm_c/Makefile install
</code></pre>
<p>After the build dependencies are installed, clone the <strong>QEMU</strong>
repository and switch to the branch that supports <strong>IGVM</strong>:</p>
<pre><code>$ git clone https://github.com/coconut-svsm/qemu
$ cd qemu
$ git checkout svsm-igvm
</code></pre>
<p>Now the right branch is checked out and you can continue with the build.
Feel free to adapt the installation directory to your needs:</p>
<pre><code>$ ./configure --prefix=$HOME/bin/qemu-svsm/ --target-list=x86_64-softmmu --enable-igvm
$ ninja -C build/
$ make install
</code></pre>
<p><strong>QEMU</strong> is now installed and ready to run an <strong>AMD SEV-SNP</strong> guest with
an <strong>SVSM</strong> embedded in an <strong>IGVM</strong> file.</p>
<h3 id="starting-thevm">Starting the¬†VM</h3>
<p>To start and test the VM we can use <a href="https://github.com/ultravioletrs/cocos/tree/main/manager">COCOS AI manager
component</a>. However, to make this testing process a bit simpler,
we will use the newly compiled QEMU and point it to all the necessary
files:</p>
<pre><code># $QEMU_BIN -&gt; path to qemu binary
# $IGVM -&gt; path to IGVM binary
# $KERNEL -&gt; path to signed kernel
# $INITRD -&gt; path to init RAM file system

sudo $QEMU_BIN \
  -enable-kvm \
  -cpu host \
  -machine q35,confidential-guest-support=sev0,memory-backend=ram1,igvm-cfg=igvm0 \
  -smp 4,maxcpus=16 \
  -m 25G,slots=5,maxmem=30G \
  -object memory-backend-memfd,id=ram1,size=25G,share=true,prealloc=false,reserve=false \
  -object sev-snp-guest,id=sev0,cbitpos=51,reduced-phys-bits=1 \
  -object igvm-cfg,id=igvm0,file=&quot;$IGVM&quot; \
  -device virtio-net-pci,disable-legacy=on,iommu_platform=true,netdev=vmnic,romfile= \
  -netdev user,id=vmnic \
  -kernel $KERNEL \
  -initrd $INITRD \
  -append &quot;console=ttyS0 earlyprintk=ttyS0,115200 ima_policy=tcb&quot; \
  -nographic \
  -monitor unix:monitor,server,nowait
</code></pre>
<p>The <strong>append</strong> flag appends the string to the kernel command line
parameters. The parameter <strong>ima_policy=tcb</strong> enables the Linux IMA. In
this mode Linux IMA only measures files that pass through RAM.</p>
<p>If the boot was successful, that means the firmware verified the kernel
signature. When the VM boots, there should be a <strong>/dev/tpm0</strong> folder
which represents the TPM. The Linux IMA measurements can be found in the
<strong>/sys/kernel/security/ima/ascii_runtime_measurements</strong> file. The
<strong>SHA1</strong> <strong>PCR10</strong> register can be used to verify the Linux IMA
measurements.</p>
<p>The values of TPM PCRs and the data from
<code>ascii_runtime_measurements</code> can be
included in the attestation report to strengthen the machine's
verification process.</p>
<h3 id="conclusion"><strong>Conclusion</strong></h3>
<p>In this article, we explored how to launch a custom virtual machine with
<strong>Secure Boot</strong>, <strong>Measured Boot</strong>, and <strong>Linux IMA</strong> enabled. Together,
these features record measurements of boot components and provide
assurance that the VM has started in a trusted, &quot;good state.&quot;</p>
<p>Cloud Service Providers (CSPs) typically don't grant this level of
control. For example, on <strong>Google Cloud Platform (GCP)</strong> you cannot
supply your own firmware or kernel. What they do offer, however, is a
way to verify the integrity of the boot process: you can download the
firmware and kernel they provide, inspect them locally, and calculate
their measurements to confirm that what booted in the cloud matches what
you expect.</p>
<h3 id="literature">Literature</h3>
<p>[1] <a href="https://github.com/ultravioletrs/cocos">https://github.com/ultravioletrs/cocos</a></p>
<p>[2] <a href="https://en.wikipedia.org/wiki/UEFI#Secure_Boot">https://en.wikipedia.org/wiki/UEFI#Secure_Boot</a></p>
<p>[3]
<a href="https://tianocore-docs.github.io/edk2-TrustedBootChain/release-1.00/3_TCG_Trusted_Boot_Chain_in_EDKII.html">https://tianocore-docs.github.io/edk2-TrustedBootChain/release-1.00/3_TCG_Trusted_Boot_Chain_in_EDKII.html</a></p>
<p>[4] <a href="https://ima-doc.readthedocs.io/en/latest/ima-concepts.html">https://ima-doc.readthedocs.io/en/latest/ima-concepts.html</a></p>
<p>[5]<a href="https://github.com/coconut-svsm/svsm">https://github.com/coconut-svsm/svsm</a></p>
<p>[6] <a href="https://github.com/tianocore/edk2">https://github.com/tianocore/edk2</a></p>
<p>[7] <a href="https://docs.rs/igvm_defs/0.1.3/igvm_defs/index.html">https://docs.rs/igvm_defs/0.1.3/igvm_defs/index.html</a></p>
<p>[8] <a href="https://pypi.org/project/virt-firmware/">https://pypi.org/project/virt-firmware/</a></p>
</div>

        <div class="mt-5 pt-4 border-top">
          
          <div>
            <a href="/blog" class="btn btn-outline-secondary"><i class="fas fa-arrow-left me-2"></i>Back to
              Blog</a>
          </div>
          <h5 class="mb-3 mt-3">Tags</h5>
          <div>
            
            <span class="badge bg-light text-dark me-2 mb-2 fs-6">confidential-computing</span>
            
            <span class="badge bg-light text-dark me-2 mb-2 fs-6">secured boot</span>
            
            <span class="badge bg-light text-dark me-2 mb-2 fs-6">measured boot</span>
            
            <span class="badge bg-light text-dark me-2 mb-2 fs-6">TPM</span>
            
            <span class="badge bg-light text-dark me-2 mb-2 fs-6">Linux IMA</span>
            
            <span class="badge bg-light text-dark me-2 mb-2 fs-6">cocos</span>
            
          </div>
        </div>

        <div class="mt-4">
          <h5 class="mb-3">Share this article</h5>
          <div class="d-flex gap-2 flex-wrap">
            <a href="https://twitter.com/intent/tweet?text=Trusting&#43;Your&#43;VM&#43;from&#43;the&#43;First&#43;Instruction&#43;to&#43;the&#43;Last&#43;File&url=https%3a%2f%2fwww.ultraviolet.rs/blog/trusting-your-vm-from-the-first-instruction-to-the-last-file"
              target="_blank" rel="noopener" class="btn btn-outline-dark btn-sm">
              <i class="fab fa-twitter me-2"></i>Twitter
            </a>
            <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2fwww.ultraviolet.rs/blog/trusting-your-vm-from-the-first-instruction-to-the-last-file"
              target="_blank" rel="noopener" class="btn btn-outline-dark btn-sm">
              <i class="fab fa-linkedin me-2"></i>LinkedIn
            </a>
          </div>
        </div>
      </div>
    </div>
  </article>

  
  <section id="newsletter" class="py-5">
    <div class="container">
      <div class="row mt-5 mb-5">
        <div class="col-md-6 offset-md-3 text-center">
          <h2>Subscribe to Our Newsletter</h2>
          <p>Stay updated with the latest news, updates and announcements.</p>

          
          <form
            action="https://absmach.us11.list-manage.com/subscribe/post?u=70b43c7181d005024187bfb31&amp;id=0a319b6b63&amp;f_id=002711e1f0"
            method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate"
            target="_blank">
            <div class="input-group">
              <input type="email" class="form-control" name="EMAIL" id="mce-EMAIL" placeholder="Enter your email"
                aria-label="Email" aria-describedby="subscribe-btn" required="" />
              <div hidden="">
                <input type="hidden" name="tags" value="8115258" />
              </div>
              <button class="btn bg-deep-blue" type="submit" id="subscribe-btn"
                style="background-color: #073763; color: white;">
                Subscribe
              </button>
            </div>
            <div id="mce-responses" class="clear foot">
              <div class="response" id="mce-error-response" style="display: none"></div>
              <div class="response" id="mce-success-response" style="display: none"></div>
            </div>
            <div style="position: absolute; left: -5000px" aria-hidden="true">
              
              <input type="text" name="b_70b43c7181d005024187bfb31_0a319b6b63" tabindex="-1" value="" />
            </div>

            
            <div class="mt-2">
              <div class="mt-2">
                <p class="mb-0" style="font-size: 0.75rem; color: #6c757d; line-height: 1.4">
                  By subscribing, you agree to our
                  <a href="/privacy" target="_blank" class="link-blue-sm">Privacy Policy</a>
                  and
                  <a href="/terms" target="_blank" class="link-blue-sm">Terms of Service</a>. <br />You can unsubscribe
                  at any time.
                </p>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>
  

  
  
  <section class="py-5 bg-light">
    <div class="container">
      <h3 class="mb-4 fw-bold">Next Read</h3>
      <div class="row g-4">
        
        <div class="col-md-6 col-lg-4">
          <article class="card h-100 shadow-sm hover-lift border-0">
            <a href="/blog/securing-trus-rats-and-attested-tls" class="text-decoration-none text-dark">
              

              <div class="card-body">
                <div class="mb-2">
                  <span class="badge bg-primary me-2">
                    blog
                  </span>
                  
                </div>

                <h2 class="card-title h5 fw-bold">
                  Securing Trust: RATS and Attested TLS (aTLS)
                </h2>
                <p class="card-text text-muted small">
                  COCOS AI leverages modern attestation standards to prove the integrity and operational state of the platform.
                </p>

                <div class="d-flex align-items-center mt-3">
                  <img src="https://avatars.githubusercontent.com/u/44265300?v=4" alt="Jovan Djukic"
                    class="rounded-circle me-2" width="32" height="32" loading="lazy"
                    onerror="this.onerror=null; this.src = '/assets/team/default-avatar.jpg'" />
                  <div class="small">
                    <div class="fw-semibold">
                      Jovan Djukic
                    </div>
                    <div class="text-muted">
                      February 09, 2026 ¬∑ 9 min
                    </div>
                  </div>
                </div>

                <div class="mt-3">
                  
                  <span class="badge bg-light text-dark me-1">confidential-computing</span>
                  
                  <span class="badge bg-light text-dark me-1">attestation</span>
                  
                  <span class="badge bg-light text-dark me-1">aTLS</span>
                  
                  <span class="badge bg-light text-dark me-1">cocos ai</span>
                  
                </div>
              </div>
            </a>
          </article>
        </div>
        
        <div class="col-md-6 col-lg-4">
          <article class="card h-100 shadow-sm hover-lift border-0">
            <a href="/blog/cocos-prism-release" class="text-decoration-none text-dark">
              

              <div class="card-body">
                <div class="mb-2">
                  <span class="badge bg-primary me-2">
                    blog
                  </span>
                  
                </div>

                <h2 class="card-title h5 fw-bold">
                  Unleashing Confidential AI: Cocos v0.8.0 and Prism v0.6.0 Released
                </h2>
                <p class="card-text text-muted small">
                  Ultraviolet releases Cocos AI v0.8.0 and Prism v0.6.0, enhancing the confidential computing ecosystem. These updates bring improved attestation, stronger security, and a better enterprise experience.
                </p>

                <div class="d-flex align-items-center mt-3">
                  <img src="https://avatars.githubusercontent.com/u/44265300?v=4" alt="sammy oina"
                    class="rounded-circle me-2" width="32" height="32" loading="lazy"
                    onerror="this.onerror=null; this.src = '/assets/team/default-avatar.jpg'" />
                  <div class="small">
                    <div class="fw-semibold">
                      sammy oina
                    </div>
                    <div class="text-muted">
                      February 06, 2026 ¬∑ 4 min
                    </div>
                  </div>
                </div>

                <div class="mt-3">
                  
                  <span class="badge bg-light text-dark me-1">confidential-computing</span>
                  
                  <span class="badge bg-light text-dark me-1">ai</span>
                  
                  <span class="badge bg-light text-dark me-1">cocos</span>
                  
                  <span class="badge bg-light text-dark me-1">prism</span>
                  
                  <span class="badge bg-light text-dark me-1">privacy</span>
                  
                </div>
              </div>
            </a>
          </article>
        </div>
        
        <div class="col-md-6 col-lg-4">
          <article class="card h-100 shadow-sm hover-lift border-0">
            <a href="/blog/confidential-computing-meets-ai" class="text-decoration-none text-dark">
              

              <div class="card-body">
                <div class="mb-2">
                  <span class="badge bg-primary me-2">
                    blog
                  </span>
                  
                </div>

                <h2 class="card-title h5 fw-bold">
                  Confidential Computing Meets AI: How Cube AI Protects Your LLM Prompts
                </h2>
                <p class="card-text text-muted small">
                  Cube AI leverages confidential computing and TEEs to protect your sensitive AI workloads. Ensure your prompts remain private with hardware-verified security.
                </p>

                <div class="d-flex align-items-center mt-3">
                  <img src="https://avatars.githubusercontent.com/u/44265300?v=4" alt="sammy oina"
                    class="rounded-circle me-2" width="32" height="32" loading="lazy"
                    onerror="this.onerror=null; this.src = '/assets/team/default-avatar.jpg'" />
                  <div class="small">
                    <div class="fw-semibold">
                      sammy oina
                    </div>
                    <div class="text-muted">
                      January 30, 2026 ¬∑ 4 min
                    </div>
                  </div>
                </div>

                <div class="mt-3">
                  
                  <span class="badge bg-light text-dark me-1">security</span>
                  
                  <span class="badge bg-light text-dark me-1">confidential-computing</span>
                  
                  <span class="badge bg-light text-dark me-1">ai</span>
                  
                  <span class="badge bg-light text-dark me-1">privacy</span>
                  
                  <span class="badge bg-light text-dark me-1">cube ai</span>
                  
                </div>
              </div>
            </a>
          </article>
        </div>
        
      </div>
    </div>
  </section>
  

  
  <footer class="bg-dark text-white py-3">
    <div class="container">
      <div class="row mt-3 mb-2">
        <div class="col">
          <h3>About Us</h3>
          <p class="w-65">
            Ultraviolet is a leading company specializing in confidential
            computing, cloud security, AI/ML, multi-party computation, and
            secure data sharing.
          </p>
        </div>

        <div class="col">
          <h3>Products</h3>
          <ul class="list-unstyled">
            <li>
              <i class="fas fa-network-wired me-2"></i><a href="prism/" class="text-white">Prism AI</a>
            </li>
            <li>
              <i class="fas fa-cog me-2"></i><a href="cocos/" class="text-white">Cocos AI</a>
            </li>
            <li>
              <i class="fas fa-cube"></i>
              <a href="cube/" class="text-white">Cube AI</a>
            </li>
          </ul>
          <h3>Resources</h3>
          <ul class="list-unstyled">
            <li>
              <a href="https://docs.google.com/presentation/d/199CkKD4YpgfJ1CLWVyZ9TdmXLLvME7JHN4Kfjkbgmho/export/pdf"
                class="text-white">
                Prism AI Datasheet
              </a>
            </li>
            <li>
              <a href="https://docs.google.com/presentation/d/1oZDjQjuzNR8PeI1AHS8tePaiA73SmjnjrFFEBoS6b68/export/pdf"
                class="text-white">
                Cocos AI Datasheet
              </a>
            </li>
            <li>
              <a href="https://docs.google.com/presentation/d/1UJR6HKiBV3r56SyMNZvO3ylek8VFmNojbFkTC-bawBY/export/pdf"
                class="text-white">
                Cube AI Datasheet
              </a>
            </li>
          </ul>
        </div>
        <div class="col">
          <h3>Legal</h3>
          <ul class="list-unstyled">
            Prism AI
            <li>
              <a href="/prism/terms" class="text-white"> Terms of Service</a>
            </li>
            <li>
              <a href="/prism/privacy" class="text-white"> Privacy Policy</a>
            </li>
            <br />
            Cube AI
            <li>
              <a href="/cube/terms" class="text-white">Terms of Service</a>
            </li>
            <li>
              <a href="/cube/privacy" class="text-white">Privacy Policy</a>
            </li>
          </ul>
        </div>
        <div class="col">
          <h3>Connect With Us</h3>
          <ul class="list-unstyled">
            <li>
              <i class="fab fa-twitter me-2"></i><a href="https://twitter.com/ultravioletrs" class="text-white"
                target="_blank">Twitter</a>
            </li>
            <li>
              <i class="fab fa-linkedin me-2"></i><a href="https://www.linkedin.com/company/ultravioletrs"
                class="text-white" target="_blank">LinkedIn</a>
            </li>
            <li>

            <li>
              <i class="fab fa-github me-2"></i><a href="https://github.com/ultravioletrs" class="text-white"
                target="_blank">GitHub</a>
            </li>
          </ul>
        </div>
        <div class="col">
          <h3>Contact Us</h3>
          <p>
            <i class="fas fa-envelope me-2"></i><a href="mailto:info@ultraviolet.rs"
              class="text-white">info@ultraviolet.rs</a>
          </p>
          <p>
            <i class="fab fa-gitter me-2"></i><a href="https://app.gitter.im/#/room/#Ultraviolet_community:gitter.im"
              class="text-white" target="_blank">Chat on Gitter</a>
          </p>
          <p>
            <i class="fas fa-map-marker-alt me-2"></i>Bulevar Arsenija
            Carnojevica 103, 11000 Belgrade, Serbia
          </p>
        </div>
      </div>
    </div>
  </footer>
  


  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.10.2/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CH54M1Z8DY"></script>

  
  <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
  <script>
    function getCookie(name) {
      var b = document.cookie.match(
        "(^|[^;]+)\\s*" + name + "\\s*=\\s*([^;]+)",
      );
      return b ? b.pop() : "";
    }

    function addAnalytics() {
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-CH54M1Z8DY");
    }

    document.addEventListener("DOMContentLoaded", function () {
      
      const cookieConsent = getCookie("cookieconsent_status");

      
      if (cookieConsent === "allow" || cookieConsent === "") {
        addAnalytics();
      }

      if (typeof window.cookieconsent !== "undefined") {
        window.cookieconsent.initialise({
          palette: {
            popup: { background: "#000" },
            button: { background: "#f1d600" },
          },
          revokable: true,
          law: {
            regionalLaw: {
              EU: true, 
              UK: true, 
            },
          },
          location: true, 
          type: "opt-out",
          content: {
            message:
              "üç™ We use cookies to collect data to improve your experience on our site.",
            allow: "Allow",
            dismiss: "Allow",
            deny: "Reject",
          },
          onStatusChange: function (status, chosenBefore) {
            location.reload();
          },
        });
      } else {
        console.error("Cookie consent script not loaded.");
      }
    });
  </script>

  <script>
    
    document.addEventListener('DOMContentLoaded', async () => {
      
      if (typeof mermaid !== 'undefined') {
        mermaid.initialize({ startOnLoad: false, theme: 'default', logLevel: 'debug' });
      }

      
      const markdownContent = document.querySelector('.markdown-content');
      if (markdownContent) {
        const pres = markdownContent.querySelectorAll('pre');

        pres.forEach(pre => {
          const code = pre.querySelector('code');
          if (code && code.className.includes('language-mermaid')) {
            const mermaidDiv = document.createElement('div');
            mermaidDiv.className = 'mermaid';
            mermaidDiv.textContent = code.textContent;
            pre.replaceWith(mermaidDiv);
          }
        });
      }

      
      if (typeof mermaid !== 'undefined') {
        try {
          await mermaid.run();
        } catch (e) {
          console.error('Mermaid rendering error:', e);
        }
      }

      hljs.highlightAll();

      const pres = document.querySelectorAll('.markdown-content pre');

      pres.forEach(pre => {
        const wrapper = document.createElement('div');
        wrapper.className = 'code-wrapper';
        pre.parentNode.insertBefore(wrapper, pre);
        wrapper.appendChild(pre);

        const btn = document.createElement('button');
        btn.className = 'copy-button';
        btn.type = 'button';
        btn.innerHTML = '<i class="far fa-copy"></i>';
        btn.setAttribute('aria-label', 'Copy code to clipboard');
        btn.title = 'Copy code';

        wrapper.appendChild(btn);
      });
    });

    document.addEventListener('click', async (e) => {
      const btn = e.target.closest('.copy-button');
      if (!btn) return;

      const pre = btn.parentElement.querySelector('pre');
      const code = pre.querySelector('code') || pre;
      const text = code.textContent;

      try {
        if (navigator.clipboard && window.isSecureContext) {
          await navigator.clipboard.writeText(text);
        } else {
          
          const textarea = document.createElement('textarea');
          textarea.value = text;
          textarea.style.position = 'fixed';
          textarea.style.opacity = '0';
          document.body.appendChild(textarea);
          textarea.focus();
          textarea.select();
          document.execCommand('copy');
          document.body.removeChild(textarea);
        }

        btn.innerHTML = '<i class="fas fa-check"></i>';
        btn.classList.add('copied');
        btn.title = 'Copied!';

        setTimeout(() => {
          btn.innerHTML = '<i class="far fa-copy"></i>';
          btn.classList.remove('copied');
          btn.title = 'Copy code';
        }, 2000);

      } catch (err) {
        console.error('Copy failed', err);
        btn.innerHTML = '<i class="fas fa-times"></i>';
        setTimeout(() => btn.innerHTML = '<i class="far fa-copy"></i>', 2000);
      }
    });
  </script>

</body>

</html>